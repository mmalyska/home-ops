app-template:
  controllers:
    main:
      strategy: Recreate
      containers:
        main:
          image:
            repository: public.ecr.aws/docker/library/eclipse-mosquitto
            tag: 2.0.18@sha256:906863ed93e927fb59808cdd0491222746aebd9c8631d0f4a02e8518a343b63c
            pullPolicy: IfNotPresent
          resources:
            requests:
              cpu: 5m
              memory: 10M
            limits:
              memory: 10M
      initContainers:
        copy-config:
          image:
            repository: public.ecr.aws/docker/library/eclipse-mosquitto
            tag: 2.0.18@sha256:906863ed93e927fb59808cdd0491222746aebd9c8631d0f4a02e8518a343b63c
            pullPolicy: IfNotPresent
          command:
            - "/bin/sh"
            - -c
          args:
            - cp /data/mosquitto_secret/* /data/external_config/ && mosquitto_passwd -U /data/external_config/mosquitto_pwd
  service:
    main:
      type: LoadBalancer
      annotations:
        metallb.universe.tf/loadBalancerIPs: "192.168.48.26"
      externalTrafficPolicy: Cluster
      ports:
        http:
          enabled: false
        mqtt:
          enabled: true
          port: 1883
  persistence:
    mosquitto-config:
      enabled: true
      type: configMap
      name: mosquitto-configmap
      advancedMounts:
        main:
          main:
            - path: /mosquitto/config/mosquitto.conf
              subPath: mosquitto.conf
    mosquitto-secret:
      enabled: true
      type: secret
      name: mosquitto-secret
      advancedMounts:
        main:
          copy-config:
            - path: /data/mosquitto_secret
    external-config:
      enabled: true
      type: emptyDir
      advancedMounts:
        main:
          main:
            - path: /mosquitto/external_config
          copy-config:
            - path: /data/external_config
