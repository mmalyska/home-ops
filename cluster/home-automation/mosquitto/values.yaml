app-template:
  image:
    repository: public.ecr.aws/docker/library/eclipse-mosquitto
    tag: 2.0.18@sha256:9f24f0560e13b8d8983757472770b404f270210f88b4ce0efcd547458f05e817
  initContainers:
    copy-config:
      image: public.ecr.aws/docker/library/eclipse-mosquitto:2.0.18@sha256:9f24f0560e13b8d8983757472770b404f270210f88b4ce0efcd547458f05e817
      command:
        - "/bin/sh"
        - -c
      args:
        - cp /data/mosquitto_secret/* /data/external_config/ && mosquitto_passwd -U /data/external_config/mosquitto_pwd
      volumeMounts:
        - name: mosquitto-secret
          mountPath: /data/mosquitto_secret
        - name: external-config
          mountPath: /data/external_config
  service:
    main:
      type: LoadBalancer
      annotations:
        metallb.universe.tf/loadBalancerIPs: "192.168.48.26"
      externalTrafficPolicy: Cluster
      ports:
        http:
          enabled: false
        mqtt:
          enabled: true
          port: 1883
  persistence:
    mosquitto-config:
      enabled: true
      type: configMap
      name: mosquitto-configmap
      mountPath: /mosquitto/config/mosquitto.conf
      subPath: mosquitto.conf
    mosquitto-secret:
      enabled: true
      type: secret
      name: mosquitto-secret
      mountPath: "-"
    external-config:
      enabled: true
      type: emptyDir
      mountPath: /mosquitto/external_config
  resources:
    requests:
      cpu: 5m
      memory: 10M
    limits:
      memory: 10M
  volumeClaimTemplates:
    - name: data
      mountPath: /data
      size: 512Mi
