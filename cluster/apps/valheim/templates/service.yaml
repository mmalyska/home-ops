apiVersion: v1
kind: Service
metadata:
  name: {{ template "valheim.fullname" . }}
  labels: {{- include "valheim.labels" (dict "context" . "component" .Values.server.name "name" .Values.server.name) | nindent 4 }}
spec:
  ports:
    - name: gameport
      port: {{ .Values.server.networking.gamePort | int }}
      targetPort: {{ .Values.server.networking.gamePort | int }}
      protocol: UDP
      {{- if eq .Values.server.networking.serviceType "NodePort" }}
      nodePort: {{ default "" .Values.server.networking.gameNodePort }}
      {{- end }}
    - name: queryport
      port: {{ .Values.server.networking.queryport | int }}
      targetPort: {{ .Values.server.networking.queryport | int }}
      protocol: UDP
      {{- if eq .Values.server.networking.serviceType "NodePort" }}
      nodePort: {{ default "" (.Values.server.networking.queryNodePort | int ) }}
      {{- end }}
    - name: queryport2
      port: {{ .Values.server.networking.queryport2 | int }}
      targetPort: {{ .Values.server.networking.queryport2 | int }}
      protocol: UDP
      {{- if eq .Values.server.networking.serviceType "NodePort" }}
      nodePort: {{ default "" (.Values.server.networking.queryNodePort2 | int ) }}
      {{- end }}
    - name: statusport
      port: 80
      targetport: 80
      {{- if eq .Values.server.networking.serviceType "NodePort" }}
      nodePort: {{ default "" (.Values.server.networking.statusNodePort | int ) }}
      {{- end }}
  type: {{ .Values.server.networking.serviceType }}
  {{- if eq .Values.server.networking.serviceType "LoadBalancer" }}
  loadBalancerIP: {{ default "" .Values.server.networking.loadBalancerIP }}
  {{- end }}
  selector:
    {{- include "valheim.selectorLabels" (dict "context" . "name" .Values.server.name) | nindent 6 }}
