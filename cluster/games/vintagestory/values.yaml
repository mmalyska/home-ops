# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/refs/tags/app-template-3.6.1/charts/other/app-template/values.schema.json
---
defaultPodOptions:
  securityContext:
    runAsUser: 568
    runAsGroup: 568
    fsGroup: 568
    fsGroupChangePolicy: "OnRootMismatch"
controllers:
  main:
    type: statefulset
    strategy: RollingUpdate
    replicas: 1
    initContainers:
      init:
        image:
          repository: ghcr.io/mmalyska/vintagestory-mods-downloader
          tag: v0.1.1@sha256:38844e2245a7e603a797447651b855c592bcbfd3cbb65d848d93522b301a0e90
        env:
          download-path: /mods
          # renovate: datasource=docker depName=ghcr.io/mmalyska/vintagestory
          vs-version: 1.20.12
          config-file: mods.json
    containers:
      vintagestory:
        image:
          repository: ghcr.io/mmalyska/vintagestory
          tag: 1.20.12@sha256:761a025df804311b34de55e4a17bb709a8ef84777810b73dc255758fd47a8608
        env:
          DATA_PATH: /config
        args:
          - --addModPath
          - /mods
        resources:
          requests:
            cpu: 500m
            memory: 2Gi
          limits:
            memory: 6Gi
service:
  vintagestory:
    controller: main
    annotations:
      io.cilium/lb-ipam-ips: "192.168.48.28"
    type: LoadBalancer
    ports:
      tcp:
        protocol: TCP
        port: 42420
      udp:
        protocol: UDP
        port: 42420
persistence:
  config:
    enabled: true
    type: persistentVolumeClaim
    accessMode: ReadWriteOnce
    storageClass: ceph-block
    volumeName: pvc-d90638e7-a275-456c-b359-9b6b3c3c874f
    size: 5Gi
    globalMounts:
      - path: /config
  mods:
    enabled: true
    type: emptyDir
  mods-config:
    enabled: true
    name: mods-config
    type: configMap
    advancedMounts:
      main:
        init:
          - path: /app/mods.json
            subPath: mods.json
            readOnly: true
configMapsFromFolder:
  basePath: "files/configmaps"
  enabled: true
  configMapsOverrides:
    mods-config:
      forceRename: mods-config
