# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/refs/tags/app-template-3.6.1/charts/other/app-template/values.schema.json
---
defaultPodOptions:
  securityContext:
    runAsUser: 568
    runAsGroup: 568
    fsGroup: 568
    fsGroupChangePolicy: "OnRootMismatch"
controllers:
  main:
    type: statefulset
    strategy: RollingUpdate
    replicas: 1
    initContainers:
      init:
        image:
          repository: ghcr.io/mmalyska/vintagestory-mods-downloader
          tag: v0.2.0@sha256:1e6ec92c47263c58804dd3098abdf70519e2ce2b37a66ac25b71a58b41a36545
        env:
          download-path: /mods
          # renovate: datasource=docker depName=ghcr.io/mmalyska/vintagestory
          vs-version: 1.21.1
          config-file: mods.json
    containers:
      vintagestory:
        image:
          repository: ghcr.io/mmalyska/vintagestory
          tag: 1.21.1@sha256:034aef80cc2a00c67d9cfbede93006be8d4f5a407a8d2b51719b144842a5d414
        env:
          DATA_PATH: /config
        args:
          - --addModPath
          - /mods
        resources:
          requests:
            cpu: 500m
            memory: 2Gi
          limits:
            memory: 6Gi
service:
  vintagestory:
    controller: main
    annotations:
      io.cilium/lb-ipam-ips: "192.168.48.28"
    type: LoadBalancer
    ports:
      tcp:
        protocol: TCP
        port: 42420
      udp:
        protocol: UDP
        port: 42420
persistence:
  config:
    enabled: true
    type: persistentVolumeClaim
    accessMode: ReadWriteOnce
    storageClass: ceph-block
    volumeName: pvc-d90638e7-a275-456c-b359-9b6b3c3c874f
    size: 5Gi
    globalMounts:
      - path: /config
  mods:
    enabled: true
    type: emptyDir
  mods-config:
    enabled: true
    name: mods-config
    type: configMap
    advancedMounts:
      main:
        init:
          - path: /app/mods.json
            subPath: mods.json
            readOnly: true
configMapsFromFolder:
  basePath: "files/configmaps"
  enabled: true
  configMapsOverrides:
    mods-config:
      forceRename: mods-config
