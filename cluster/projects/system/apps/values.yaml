---
project: system
destination:
  server: https://kubernetes.default.svc
source:
  repoURL: https://github.com/mmalyska/home-ops
  path: cluster/system
apps:
  - name: cert-manager
    namespace: cert-manager
    path: cert-manager
    plugin:
      env:
        - name: SOPS_SECRET_FILE
          value: secret.sec.yaml
  # - name: cloudnative-pg
  #   namespace: cnpg
  #   path: cloudnative-pg
  # - name: kubernetes-dashboard
  #   namespace: kubernetes-dashboard
  #   path: dashboard
  #   plugin:
  #     env:
  #       - name: SOPS_SECRET_FILE
  #         value: secret.sec.yaml
  # - name: dyndns
  #   namespace: dyndns
  #   path: dyndns
  #   plugin:
  #     env:
  #       - name: SOPS_SECRET_FILE
  #         value: secret.sec.yaml
  # - name: keycloak
  #   namespace: identity
  #   path: identity/keycloak
  #   syncPolicy: true
  #   selfHeal: true
  #   plugin:
  #     env:
  #       - name: SOPS_SECRET_FILE
  #         value: secret.sec.yaml
  # - name: metrics-server
  #   namespace: metrics-server
  #   path: metrics-server
  # - name: nfs-subdir-external-provisioner
  #   namespace: nfs-subdir-provisioner
  #   path: nfs-subdir-external-provisioner
  #   plugin:
  #     env:
  #       - name: SOPS_SECRET_FILE
  #         value: secret.sec.yaml
  # - name: oauth2-proxy
  #   namespace: oauth2-proxy
  #   path: oauth2-proxy
  #   plugin:
  #     env:
  #       - name: SOPS_SECRET_FILE
  #         value: secret.sec.yaml
  - name: prometheus-stack
    namespace: monitoring
    path: prometheus-stack
    plugin:
      env:
        - name: SOPS_SECRET_FILE
          value: secret.sec.yaml
    extraSyncOptions:
      - ServerSideApply=true
  - name: traefik-internal
    namespace: traefik-internal
    path: traefik-internal
    plugin:
      env:
        - name: SOPS_SECRET_FILE
          value: secret.sec.yaml
  - name: traefik
    namespace: traefik
    path: traefik
    plugin:
      env:
        - name: SOPS_SECRET_FILE
          value: secret.sec.yaml
  # - name: node-feature-discovery
  #   namespace: node-feature-discovery
  #   path: node-feature-discovery
  #   extraSyncOptions:
  #     - RespectIgnoreDifferences=true
  #   ignoreDifferences:
  #     - group: apps
  #       kind: DaemonSet
  #       jsonPointers:
  #         - /spec/template/metadata/annotations
  # - name: intel-device-plugins-operator
  #   namespace: intel-device-plugins-operator
  #   path: intel-device-plugins-operator
  # - name: intel-gpu-plugin
  #   namespace: intel-gpu-plugin
  #   path: intel-gpu-plugin
  #   extraSyncOptions:
  #     - RespectIgnoreDifferences=true
  #   ignoreDifferences:
  #     - group: deviceplugin.intel.com
  #       kind: GpuDevicePlugin
  #       jsonPointers:
  #         - /spec/resourceManager
  # - name: snapshot-controller
  #   namespace: snapshot-controller
  #   path: snapshot-controller
  # - name: snapshot-validation-webhook
  #   namespace: snapshot-validation-webhook
  #   path: snapshot-validation-webhook
  # - name: external-secrets
  #   namespace: external-secrets
  #   path: external-secrets
  #   plugin:
  #     env:
  #       - name: SOPS_SECRET_FILE
  #         value: secret.sec.yaml
  # - name: kubelet-csr-approver
  #   namespace: kube-system
  #   path: kubelet-csr-approver
  # - name: volsync
  #   namespace: volsync
  #   path: volsync
