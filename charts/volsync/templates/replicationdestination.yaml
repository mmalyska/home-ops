---
# yaml-language-server: $schema=https://k8s-schemas.bjw-s.dev/volsync.backube/replicationdestination_v1alpha1.json
apiVersion: volsync.backube/v1alpha1
kind: ReplicationDestination
metadata:
  name: {{ include "volsync.bootstrap" $}}
spec:
  trigger:
    manual: restore-once
  restic:
    accessModes:
      - {{ .Values.pvc.accessMode }}
    capacity: {{ .Values.pvc.capacity }}
    storageClassName: {{ .Values.pvc.storageClass }}
    cacheCapacity: {{ .Values.pvc.capacity }}
    volumeSnapshotClassName: {{ .Values.pvc.volumeSnapshotClass }}
    repository: {{ include "volsync.restic.secret" $ }}
    {{- if not .Values.volsync.restore.bootstrap }}
    destinationPVC: {{ include "volsync.name" $ }}
    {{- end }}
    copyMethod: Snapshot
    cleanupCachePVC: true
    cleanupTempPVC: true
    enableFileDeletion: true
    moverSecurityContext:
      runAsUser: {{ .Values.volsync.moverSecurityContext.runAsUser }}
      runAsGroup: {{ .Values.volsync.moverSecurityContext.runAsGroup }}
      fsGroup: {{ .Values.volsync.moverSecurityContext.fsGroup }}
